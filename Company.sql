SET VERIFY ON

Rem	Setup File for SQL double unit

Rem	Running this file will empty the data base that is left over from other units 
Rem	Invoke this file from the SQL window by typing @COMPANY

SET ECHO ON

Rem	Everything must first be dropped from the data base.  If an object doesn't
Rem	exist, there will be an error message, but this can be ignored.

DROP TABLE EMP CASCADE CONSTRAINTS PURGE;
DROP TABLE DEPT CASCADE CONSTRAINTS PURGE;
DROP TABLE PROJ CASCADE CONSTRAINTS PURGE;
DROP TABLE ALLOC CASCADE CONSTRAINTS PURGE;

Rem	CASCADE CONSTRAINTS is necessary to avoid violating any formal integrity
Rem	constraints on the tables.

Rem	Now we can re-create the data base:

CREATE TABLE EMP 
    (EMP_NO         CHAR(2)
         CONSTRAINT PKEY_EMP PRIMARY KEY ,
     EMP_NAME       CHAR(10),
     DEPT_NO	    CHAR(2),
     SALARY         NUMBER(6)
         CONSTRAINT SAL_RANGE CHECK (SALARY >= 6000 AND SALARY <= 150000) ,
     MARITAL_STATUS CHAR(1)
         CONSTRAINT MAR_STATS CHECK (MARITAL_STATUS IN ('S', 'M', 'W', 'D')) 
     );

CREATE TABLE DEPT
    (DEPT_NO        CHAR(2)
         CONSTRAINT PKEY_DEPT PRIMARY KEY ,
     DEPT_NAME      CHAR(10)
         CONSTRAINT UNIQ_NAME UNIQUE ,
     MANAGER_NO     CHAR(2)
         CONSTRAINT UNIQ_MANAGER UNIQUE,
     BUDGET         NUMBER(6)
         CONSTRAINT MAX_BUDG CHECK (BUDGET <= 400000) );

CREATE TABLE PROJ
    (PROJ_NO        CHAR(2)
         CONSTRAINT PKEY_PROJ PRIMARY KEY ,
     DEPT_NO        CHAR(2),
     START_DATE     DATE
         CONSTRAINT UNIQ_START UNIQUE , 
     DEADLINE       DATE,
     CONSTRAINT DURATION CHECK (TO_DATE (START_DATE, 'DD-MON-YYYY') < 
                                TO_DATE (DEADLINE, 'DD-MON-YYYY')) ); 

CREATE TABLE ALLOC
    (EMP_NO         CHAR(2),
     PROJ_NO        CHAR(2),
     CONSTRAINT     PKEY_ALLOC PRIMARY KEY (EMP_NO, PROJ_NO) );

INSERT INTO EMP
    VALUES ('E1', 'Smith', 'D1', 9900, 'W');
INSERT INTO EMP
    VALUES ('E2', 'Jones', 'D2', 13200, 'M');
INSERT INTO EMP
    VALUES ('E3', 'Roberts', 'D2', 11000, 'M');
INSERT INTO EMP
    VALUES ('E4', 'Evans', 'D3', 16500, 'S');
INSERT INTO EMP
    VALUES ('E5', 'Brown', 'D3', 27500, 'S');
INSERT INTO EMP
    VALUES ('E6', 'Green', 'D3', 13200, 'M');
INSERT INTO EMP
    VALUES ('E7', 'McDougal', 'D4', 17600, 'D');
INSERT INTO EMP
    VALUES ('E8', 'McNally', 'D5', 12100, 'M');
INSERT INTO EMP
    VALUES ('E9', 'Fletcher', 'D5', 13200, 'S');

INSERT INTO DEPT
    VALUES ('D1', 'Production', NULL, 100000);
INSERT INTO DEPT
    VALUES ('D2', 'Sales', 'E5', 250000);
INSERT INTO DEPT
    VALUES ('D3', 'Accounts', 'E9', 95000);
INSERT INTO DEPT
    VALUES ('D4', 'Admin', 'E8', 156000);
INSERT INTO DEPT
    VALUES ('D5', 'Personnel', 'E7', 196000);

INSERT INTO PROJ
    VALUES ('P1', 'D1', '20-APR-2008', '23-FEB-2009');
INSERT INTO PROJ
    VALUES ('P2', 'D1', '21-JAN-2009', '14-MAY-2009');
INSERT INTO PROJ
    VALUES ('P3', 'D2', '02-FEB-2008', '03-MAR-2009');
INSERT INTO PROJ
    VALUES ('P4', 'D3', '11-DEC-2007', '01-JAN-2009');
INSERT INTO PROJ
    VALUES ('P5', 'D4', '08-OCT-2006', '31-DEC-2008');
INSERT INTO PROJ
    VALUES ('P6', NULL, '09-OCT-2006', '30-DEC-2009');


INSERT INTO ALLOC
    VALUES ('E1', 'P1');
INSERT INTO ALLOC
    VALUES ('E1', 'P2');
INSERT INTO ALLOC
    VALUES ('E2', 'P1');
INSERT INTO ALLOC
    VALUES ('E2', 'P5');
INSERT INTO ALLOC
    VALUES ('E4', 'P4');
INSERT INTO ALLOC
    VALUES ('E5', 'P4');
INSERT INTO ALLOC
    VALUES ('E6', 'P4');
INSERT INTO ALLOC
    VALUES ('E9', 'P4');
INSERT INTO ALLOC
    VALUES ('E5', 'P3');
INSERT INTO ALLOC
    VALUES ('E7', 'P3');

ALTER TABLE EMP   ADD CONSTRAINT FKEY_DEPT  FOREIGN KEY (DEPT_NO) REFERENCES DEPT (DEPT_NO) DEFERRABLE;
ALTER TABLE DEPT  ADD CONSTRAINT FKEY_EMP   FOREIGN KEY (MANAGER_NO) REFERENCES EMP (EMP_NO) DEFERRABLE; 
ALTER TABLE PROJ  ADD CONSTRAINT FKEY_PROJ  FOREIGN KEY (DEPT_NO) REFERENCES DEPT (DEPT_NO) DEFERRABLE;
ALTER TABLE ALLOC ADD CONSTRAINT ALLOC_EMP  FOREIGN KEY (EMP_NO)  REFERENCES EMP (EMP_NO) DEFERRABLE;
ALTER TABLE ALLOC ADD CONSTRAINT ALLOC_PROJ FOREIGN KEY (PROJ_NO) REFERENCES PROJ (PROJ_NO) DEFERRABLE;

COMMIT;

REM SET ECHO OFF

PROMPT
PROMPT You are now ready to proceed with the SQL exercises.
PROMPT
